"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([[621],{8453:(e,t,n)=>{n.d(t,{R:()=>o,x:()=>a});var s=n(6540);const r={},l=s.createContext(r);function o(e){const t=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),s.createElement(l.Provider,{value:t},e.children)}},8650:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>a,default:()=>h,frontMatter:()=>o,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"full_text_search","title":"Full Text Search","description":"Tether works great with the built-in full-text search capabilities of Postgres.","source":"@site/docs/full_text_search.md","sourceDirName":".","slug":"/full_text_search","permalink":"/flutter_tether/full_text_search","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":6,"frontMatter":{"sidebar_position":6},"sidebar":"tutorialSidebar","previous":{"title":"Managers","permalink":"/flutter_tether/managers"},"next":{"title":"Configuration Reference","permalink":"/flutter_tether/config"}}');var r=n(4848),l=n(8453);const o={sidebar_position:6},a="Full Text Search",i={},c=[{value:"Setting Up Full-Text Search in Supabase",id:"setting-up-full-text-search-in-supabase",level:2},{value:"Advanced Setup",id:"advanced-setup",level:2},{value:"Using Full-Text Search in Tether",id:"using-full-text-search-in-tether",level:2}];function u(e){const t={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"full-text-search",children:"Full Text Search"})}),"\n",(0,r.jsx)(t.p,{children:"Tether works great with the built-in full-text search capabilities of Postgres.\nWhile it takes more setup that a third-party service like Elasticsearch, it is a\npowerful and flexible solution that is built into Postgres and works seamlessly\nwith Supabase."}),"\n",(0,r.jsx)(t.p,{children:"This guide will walk you through how to set up full-text search in your Supabase\nproject and how to use it in your Flutter app with Tether."}),"\n",(0,r.jsx)(t.h2,{id:"setting-up-full-text-search-in-supabase",children:"Setting Up Full-Text Search in Supabase"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsxs)(t.strong,{children:["Create a ",(0,r.jsx)(t.code,{children:"tsvector"})," Column"]}),": Add a ",(0,r.jsx)(t.code,{children:"tsvector"})," column to your table that\nyou want to search. This column will store the full-text search index."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sql",children:"ALTER TABLE books ADD COLUMN document tsvector;\n"})}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Create a Trigger"}),": Create a trigger that updates the ",(0,r.jsx)(t.code,{children:"tsvector"})," column\nwhenever the relevant columns are inserted or updated."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sql",children:"CREATE TRIGGER books_tsvector_update\nBEFORE INSERT OR UPDATE ON books\nFOR EACH ROW EXECUTE FUNCTION\ntsvector_update_trigger(document, 'pg_catalog.english', title, description);\n"})}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsx)(t.strong,{children:"Create an Index"}),": Create a GIN index on the ",(0,r.jsx)(t.code,{children:"tsvector"})," column to speed up\nsearch queries."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sql",children:"CREATE INDEX idx_books_document ON books USING GIN (document);\n"})}),"\n"]}),"\n",(0,r.jsxs)(t.li,{children:["\n",(0,r.jsxs)(t.p,{children:[(0,r.jsxs)(t.strong,{children:["Populate the ",(0,r.jsx)(t.code,{children:"tsvector"})," Column"]}),": If you have existing data, you will need\nto populate the ",(0,r.jsx)(t.code,{children:"tsvector"})," column for all existing rows."]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sql",children:"UPDATE books SET document = to_tsvector('pg_catalog.english', title || ' ' || description);\n"})}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"advanced-setup",children:"Advanced Setup"}),"\n",(0,r.jsx)(t.p,{children:"If you want to use advanced features like ranking, searching across multiple\ncolumns, or using columns in related tables, you can create a custom trigger\nfunction that combines multiple fields with different weights."}),"\n",(0,r.jsx)(t.p,{children:"Here is an example of a custom trigger that let's you set different weights for\ncolumns as well as including related table data:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-sql",children:"CREATE OR REPLACE FUNCTION update_books_document() RETURNS TRIGGER AS $$\nBEGIN\n    -- Assign different weights: 'A' for title, 'B' for description, 'C' for author's name\n    NEW.document :=\n        setweight(to_tsvector('english', COALESCE(NEW.title, '')), 'A') ||\n        setweight(to_tsvector('english', COALESCE(NEW.description, '')), 'B') ||\n        setweight(to_tsvector('english', COALESCE((SELECT authors.first_name || ' ' || authors.last_name\n                                                  FROM authors WHERE authors.id = NEW.author_id), '')), 'C');\n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\nCREATE TRIGGER books_document_update\n   BEFORE INSERT OR UPDATE ON books\n   FOR EACH ROW EXECUTE FUNCTION update_books_document();\n"})}),"\n",(0,r.jsx)(t.h2,{id:"using-full-text-search-in-tether",children:"Using Full-Text Search in Tether"}),"\n",(0,r.jsx)(t.p,{children:"Using full-text search in Tether is straightforward, as we follow the same\nconventions as the Supabase API."}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-dart",children:"final booksManager = ref.watch(booksManagerProvider);\n\n// Perform a full-text search\nfinal searchResults = await booksManager\n    .query()\n    .select(\n        BookSelectBuilder().select()\n        )\n    .textSearch(\n        BooksColumn.tsvector, // The tsvector column to search\n        'search query',\n    );\n\n// You can also combine full-text search with other filters\nfinal filteredResults = await booksManager\n    .query()\n    .select(BookSelectBuilder().select())\n    .textSearch(\n        BooksColumn.tsvector,\n        'search query',\n    )\n    .eq(BooksColumn.type, 'fiction')\n"})})]})}function h(e={}){const{wrapper:t}={...(0,l.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(u,{...e})}):u(e)}}}]);